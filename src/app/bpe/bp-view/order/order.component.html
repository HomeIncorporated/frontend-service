<div *ngIf="isReady()">
    <order-item *ngFor="let priceWrapper of priceWrappers;let i=index" [lineIndex]="i" [buyerParty]="buyerParty" [sellerParty]="sellerParty" [priceWrapper]="priceWrapper" [hidden]="isHidden(priceWrapper.item)" [selectedLine]="selectedLine"></order-item>

    <div class="row mb-4 mt-4">
        <div *ngIf="isEpcTabShown()" class="btn btn-outline-primary ml-2" [ngClass]="{'active':selectedPanel == 'TRACK_AND_TRACE'}" (click)="selectedPanel = 'TRACK_AND_TRACE'"><span [innerHTML]="'Track and Trace' | translate"></span></div>
        <div class="btn btn-outline-primary ml-2" [ngClass]="{'active':selectedPanel == 'NOTES_AND_FILES'}" (click)="selectedPanel = 'NOTES_AND_FILES'"><span [innerHTML]="'Notes and Additional Files' | translate"></span></div>
        <div class="btn btn-outline-primary ml-2" [ngClass]="{'active':selectedPanel == 'PURCHASE_ORDER'}" (click)="selectedPanel = 'PURCHASE_ORDER'"><span [innerHTML]="'Purchase Order' | translate"></span></div>
    </div>

    <!-- EPC Codes -->
    <ng-container *ngIf="selectedPanel == 'TRACK_AND_TRACE'">
        <ul class="nav nav-tabs space-after">
            <li class="nav-item">
                <a href id="EPC_CODES" class="nav-link"
                   [ngClass]="{ active: selectedTrackAndTraceTab === 'EPC_CODES'}"
                   (click)="onTTTabSelect($event,'EPC_CODES')">
                    <span [innerHTML]="'EPC Codes' | translate"></span>
                </a>
            </li>
            <li class="nav-item">
                <a href id="PRODUCTION_PROCESS_TEMPLATE" class="nav-link"
                   [ngClass]="{ active: selectedTrackAndTraceTab === 'PRODUCTION_PROCESS_TEMPLATE'}"
                   (click)="onTTTabSelect($event,'PRODUCTION_PROCESS_TEMPLATE')">
                    <span [innerHTML]="'Production Process Template' | translate"></span>
                </a>
            </li>
        </ul>

        <ng-container *ngIf="selectedTrackAndTraceTab === 'EPC_CODES'">
            <call-status [callStatus]="initEpcCodesCallStatus"></call-status>

            <div *ngIf="epcCodes" class="row">

                <!--List of codes -->
                <div class="{{ isSeller() ? 'col-9' : 'col-12' }}">
                    <div class="row mb-1" *ngFor="let code of epcCodes.codes; let i = index; trackBy:trackByFn">
                        <div class="{{ isSeller() ? 'col-9' : 'col-12' }}">
                            <input type="text" class="form-control" [(ngModel)]="epcCodes.codes[i]" [disabled]="isBuyer()">
                        </div>
                        <div class="col-3" *ngIf="isSeller()">
                            <button class="btn btn-danger w-100" (click)="onDeleteEpcCode(i)"><span [innerHTML]="'Delete' | translate"></span></button>
                        </div>
                    </div>
                </div>

                <div *ngIf="isSeller()" class="col-1"></div>

                <div *ngIf="isSeller()" class="col-2">

                    <!-- Add code -->
                    <div class="row">
                        <div class="col-12">
                            <button class="btn btn-success w-100" (click)="onAddEpcCode()"><span [innerHTML]="'Add' | translate"></span></button>
                        </div>
                    </div>

                    <!-- Save -->
                    <div class="row">
                        <div class="col-12">
                            <button class="btn btn-primary w-100 save-epc-btn" [disabled]="!areEpcCodesDirty() || !isThereAValidEPCCode()"
                                    (click)="onSaveEpcCodes()"><span [innerHTML]="'Save' | translate"></span></button>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 d-flex justify-content-end">
                  <span class="align-self-center">
                      <call-status [callStatus]="saveEpcCodesCallStatus"></call-status>
                  </span>
                        </div>
                    </div>

                </div>
            </div>
        </ng-container>

        <div *ngIf="selectedTrackAndTraceTab === 'PRODUCTION_PROCESS_TEMPLATE'">
            <div class="d-flex">
                <div class="col-3 mr-2">
                    <file-input [binaryObjects]="productionTemplateFile"
                                (onSelectFile)="onTTFileSelected($event)"
                                (onClearFile)="onTTFileRemoved()"
                                [presentationMode]="isSeller() ? 'edit' : 'view'">
                    </file-input>
                </div>
                <div *ngIf="isSeller()">
                    <button class="btn btn-primary" (click)="onUpdateOrderResponse()"><span [innerHTML]="'Save' | translate"></span></button>
                </div>
            </div>
            <call-status [large]="true" [callStatus]="updateOrderResponseCallStatus"></call-status>
        </div>
    </ng-container>

    <!-- Notes -->
    <ng-container *ngIf="selectedPanel == 'NOTES_AND_FILES'">
        <div class="row content-row" *ngIf="isReady()">
            <div class="col-6">
                <note-file-view [notes]="order.note"
                                [label]="'Customer\'s Note'"
                                [documents]="order.additionalDocumentReference"
                                [firstCol]="'col-4'"
                                [lastCol]="'col-8'"
                                [readonly]="isReadOnly() || isSeller()"></note-file-view>
            </div>
            <div class="col-6">
                <note-file-view *ngIf="orderResponse"
                                [notes]="orderResponse.note"
                                [documents]="orderResponse.additionalDocumentReference"
                                [label]="'Supplier\'s Note'"
                                [firstCol]="'col-4'"
                                [lastCol]="'col-8'"
                                [readonly]="isReadOnly()"></note-file-view>
            </div>
        </div>
    </ng-container>

    <!--Purchase Order-->
    <table class="table table-striped" *ngIf="selectedPanel == 'PURCHASE_ORDER'">
        <tr>
            <th><span>Ordered Product</span></th>
            <th><span [innerHTML]="'Product Id' | translate">Product Id</span></th>
            <th><span [innerHTML]="'Quantity' | translate">Quantity</span></th>
            <th><span [innerHTML]="'Net Price' | translate">Net Price</span></th>
            <th *ngIf="config.vatEnabled" [innerHTML]="'VAT' | translate"><span>VAT</span></th>
            <th *ngIf="config.vatEnabled" [innerHTML]="'Gross Total' | translate"><span>Gross Total</span></th>
        </tr>
        <tr *ngFor="let priceWrapper of priceWrappers;let i=index">
            <th scope="row"><span>{{priceWrapper.item.name[0].value }}</span></th>
            <td><span>{{priceWrapper.item.manufacturersItemIdentification.id}}</span></td>
            <td><span>{{quantityToString(order.orderLine[i].lineItem.quantity)}}</span></td>
            <td><span>{{priceWrapper.totalPriceString}}</span></td>
            <td *ngIf="config.vatEnabled"><span>{{priceWrapper.vatTotalString}}</span></td>
            <td *ngIf="config.vatEnabled"><span>{{priceWrapper.grossTotalString}}</span></td>
        </tr>
        <tr>
            <th scope="row"><span>Total </span></th>
            <td><span></span></td>
            <td><span></span></td>
            <td><span>{{getTotalPriceString()}}</span></td>
            <td *ngIf="config.vatEnabled"><span>{{getVatTotalString()}}</span></td>
            <td *ngIf="config.vatEnabled"><span>{{getGrossTotalString()}}</span></td>
        </tr>
    </table>

    <!-- Actions -->
    <ng-container *ngIf="isBuyer() && isReady()">

        <hr class="actions-hr">

        <div class="row actions-row" *ngIf="!isReadOnly()">
            <div class="col-8 call-status-col"><call-status [callStatus]="submitCallStatus"></call-status></div>
            <div class="col-2">
                <button class="btn btn-secondary action" [disabled]="isLoading()" (click)="onBack()">
                    <span [innerHTML]="'Back' | translate"></span>
                </button>
            </div>
            <div class="col-2">
                <button *ngIf="!(processMetadata && processMetadata.isBeingUpdated)" class="btn btn-primary action" [disabled]="isLoading()" (click)="onOrder()">
                    <span [innerHTML]="'Order' | translate"></span>
                </button>
                <button *ngIf="processMetadata && processMetadata.isBeingUpdated" class="btn btn-primary action" [disabled]="isLoading()" (click)="onOrderUpdate()">
                    <span [innerHTML]="'Update Order' | translate"></span>
                </button>
            </div>
        </div>

        <div class="row actions-row" *ngIf="isReadOnly() && !isOrderCompleted()">
            <div class="col-10 call-status-col"><call-status [callStatus]="submitCallStatus"></call-status></div>
            <div class="col-2">
                <button class="btn btn-secondary action" [disabled]="isLoading()" (click)="onBack()">
                    <span [innerHTML]="'Back' | translate"></span>
                </button>
            </div>
        </div>

        <div class="row actions-row" *ngIf="isReadOnly() && isOrderCompleted()">
            <div class="col-7 call-status-col"><call-status [callStatus]="submitCallStatus"></call-status></div>
            <div class="col-2">
                <button class="btn btn-secondary action" [disabled]="isLoading()" (click)="onBack()">
                    <span [innerHTML]="'Back' | translate"></span>
                </button>
            </div>
            <div class="col-3">
                <button class="btn btn-primary action" [disabled]="isLoading() || isOrderRejected()" (click)="onDownloadContact()">
                    <span [innerHTML]="'Download Contract' | translate"></span>
                </button>
            </div>
        </div>
    </ng-container>

    <ng-container *ngIf="isSeller() && isReady()">

        <hr class="actions-hr">

        <div class="row actions-row" *ngIf="!isOrderCompleted()">
            <div class="col-6 call-status-col"><call-status [callStatus]="submitCallStatus"></call-status></div>
            <div class="col-2">
                <button class="btn btn-secondary action" [disabled]="isLoading()" (click)="onBack()">
                    <span [innerHTML]="'Back' | translate"></span>
                </button>
            </div>
            <div class="col-2">
                <button class="btn btn-secondary action" [disabled]="isLoading() || isThereADeletedProduct()" (click)="onRespondToOrder(false)">
                    <span [innerHTML]="'Reject' | translate"></span>
                </button>
            </div>
            <div class="col-2">
                <button class="btn btn-primary action" [disabled]="isLoading() || isThereADeletedProduct()" (click)="onRespondToOrder(true)">
                    <span [innerHTML]="'Accept' | translate"></span>
                </button>
            </div>
        </div>

        <div class="row actions-row" *ngIf="isOrderCompleted()">
            <div class="{{companyWorkflowMap.get('Fulfilment') ? 'col-3' : 'col-8'}} call-status-col"><call-status [callStatus]="submitCallStatus"></call-status></div>
            <div class="col-2">
                <button class="btn btn-secondary action" [disabled]="isLoading()" (click)="onBack()">
                    <span [innerHTML]="'Back' | translate"></span>
                </button>
            </div>
            <div class="col-2">
                <button class="btn btn-secondary action" [disabled]="isLoading() || isOrderRejected()" (click)="onDownloadContact()">
                    <span [innerHTML]="'Download Contract' | translate"></span>
                </button>
            </div>
            <div class="col-3" *ngIf="companyWorkflowMap.get('Fulfilment')">
                <button class="btn btn-primary action" [disabled]="isDispatchDisabled()" (click)="onSearchTransportService()">
                    <span [innerHTML]="'Search for Transport Service Provider' | translate"></span>
                </button>
            </div>
            <div class="col-2" *ngIf="companyWorkflowMap.get('Fulfilment')">
                <button class="btn btn-primary action" [disabled]="isDispatchDisabled()" (click)="onDispatchOrder()">
                    <span [innerHTML]="'Dispatch Order' | translate"></span>
                </button>
            </div>
        </div>
    </ng-container>

</div>
